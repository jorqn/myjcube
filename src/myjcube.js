/*!commandRunning && */

//define("cube/Interpreter",[],function(){"use strict";var t={parse:function(t,e){function i(t){return"0"===t?t:1===t.length?t+"'":t.charAt(0)}for(var o,s=[],n=0,r=!1;n<t.length;)o=t.charAt(n),"2"===o?(s.push(s[s.length-1]),r=!0):"'"===o||"p"===o?(r||(s[s.length-1]+="'"),r=!1):(s.push(o),r=!1),n++;if(e){var a=s;for(s=[],n=a.length-1;n>=0;n--)s.push(i(a[n]))}return s}};return t}),define("scene/Arrow",[],function(){var t=function(t){this.material=t.material;var e=t.position,i=t.normal;this.normal=i,this.command=t.command,this.altCommand=t.altCommand;var o=t.size;this.geometry=new THREE.PlaneBufferGeometry(.25*o,.25*o,1,1),this.mesh=new THREE.Mesh(this.geometry,null),this.mesh.material=this.material.material,this.mesh.myarrow=this,this.permanent=t.permanent,this.visible=!1,this.noshift=t.noshift;var s=new THREE.Vector3(i.x,i.y,i.z),n=new THREE.Vector3(0,0,1),r=new THREE.Quaternion;r.setFromUnitVectors(n,s),this.mesh.rotateZ(Math.PI*t.angle/180);var a=new THREE.Object3D;a.add(this.mesh),a.setRotationFromQuaternion(r);var h=new THREE.Object3D;h.position.set(o*(e.x+.51*i.x),o*(e.y+.51*i.y),o*(e.z+.51*i.z)),h.add(a),this.node=new THREE.Object3D,this.node.add(h),t.node.add(this.node),this.highlight=!1,this.frameIndex=0,this.oldHighlight=!1,this.oldVisible=!1};return t.prototype.setVisible=function(t,e){t!==this.visible&&(this.frameIndex=e,this.oldHighlight=!1),this.visible=t},t.prototype.setHighlight=function(t,e){t!==this.highlight&&(this.frameIndex=e,this.oldHighlight=this.highlight),this.highlight=t},t.prototype.updateMesh=function(t){this.mesh.visible=this.material.isVisible(this,t),this.mesh.material=this.material.getMaterial(this,t)},t}),define("scene/ArrowMaterial",[],function(){"use strict";var t=function(t){function e(t){return new THREE.MeshBasicMaterial({map:i.map,transparent:!0,opacity:t,depthTest:!1,side:THREE.DoubleSide})}this.map=t.map,this.material=new THREE.MeshBasicMaterial({map:this.map,transparent:!0,opacity:.5,depthTest:!1,side:THREE.DoubleSide}),this.material0=new THREE.MeshBasicMaterial({map:this.map,transparent:!0,opacity:.25,depthTest:!1,side:THREE.DoubleSide}),this.materialHL=new THREE.MeshBasicMaterial({map:this.map,transparent:!0,depthTest:!1,side:THREE.DoubleSide}),this.materialHL0=new THREE.MeshBasicMaterial({map:this.map,transparent:!0,opacity:.75,depthTest:!1,side:THREE.DoubleSide});var i=this;this.materials={normal:[],highlight:[]},this.material.arrowMaterial=this,this.materialHL.arrowMaterial=this;var o=0;for(this.delay=10,o=0;o<this.delay;o++)this.materials.normal.push(e(.5*((o+1)/this.delay))),this.materials.highlight.push(e(.5+.5*((o+1)/this.delay)))};return t.prototype.isVisible=function(t,e){return e-t.frameIndex<this.delay||t.visible},t.prototype.getM=function(t,e){return this.materials[t][e]},t.prototype.getMaterial=function(t,e){var i=Math.min(Math.floor(e-t.frameIndex),this.delay-1);return t.visible?t.visible?t.highlight?this.getM("highlight",i):t.oldHighlight?this.getM("highlight",this.delay-i-1):this.getM("normal",i):void 0:this.getM("normal",this.delay-i-1)},t}),define("scene/ArrowMesh",[],function(){"use strict";var t=function(t){THREE.BufferGeometry.call(this),this.start=t.start,this.end=t.end,this.width=t.width,this.normal=t.normal,this.headSize=t.headSize;var e=this.start,i=new THREE.Vector3;i.subVectors(this.end,this.start);var o=i.length();i.divideScalar(o);var s=new THREE.Vector3;s.crossVectors(this.normal,i);var n,r,a=this.headSize,h=this.width,l=a/(Math.sqrt(3)/2),c=new Float32Array(21),u=new Float32Array(21),m=h/2,d=[{u:0,v:m},{u:o-a,v:m},{u:o-a,v:l/2},{u:o,v:0},{u:o-a,v:-l/2},{u:o-a,v:-m},{u:0,v:-m}];for(n=0;n<d.length;n++)r=d[n],c[3*n+0]=e.x+r.u*i.x+r.v*s.x,c[3*n+1]=e.y+r.u*i.y+r.v*s.y,c[3*n+2]=e.z+r.u*i.z+r.v*s.z,u[3*n+0]=this.normal.x,u[3*n+1]=this.normal.y,u[3*n+2]=this.normal.z;var p=new Uint16Array(15),f=0;p[f++]=0,p[f++]=1,p[f++]=6,p[f++]=6,p[f++]=1,p[f++]=5,p[f++]=1,p[f++]=2,p[f++]=3,p[f++]=1,p[f++]=3,p[f++]=5,p[f++]=5,p[f++]=3,p[f++]=4,this.addAttribute("index",new THREE.BufferAttribute(p,1)),this.addAttribute("position",new THREE.BufferAttribute(c,3)),this.addAttribute("normal",new THREE.BufferAttribute(u,3))};return t.prototype=Object.create(THREE.BufferGeometry.prototype),t.prototype.constructor=THREE.ArrowMesh,t}),define("scene/PlayBackButtonFactory",[],function(){"use strict";var t=function(t){this.size=t/(2*Math.sin(2*Math.PI/3)),this.step=1.1*t,this.width=t/5};return t.prototype.createPlayButton=function(){var t,e=new THREE.BufferGeometry,i=new Float32Array(9),o=new Float32Array(9);for(t=0;t<3;t++)i[3*t]=this.size*Math.cos(2*t*Math.PI/3),i[3*t+1]=this.size*Math.sin(2*t*Math.PI/3),i[3*t+2]=0,o[3*t]=0,o[3*t+1]=0,o[3*t+2]=1;var s=new Uint16Array(3),n=0;s[n++]=0,s[n++]=1,s[n++]=2,e.addAttribute("index",new THREE.BufferAttribute(s,1)),e.addAttribute("position",new THREE.BufferAttribute(i,3)),e.addAttribute("normal",new THREE.BufferAttribute(o,3));var r=new THREE.Mesh(e,null);return r},t.prototype.createRestartButton=function(){var t,e=new THREE.BufferGeometry,i=new Float32Array(30),o=new Float32Array(30);for(t=0;t<3;t++)i[3*t]=this.size*Math.cos(Math.PI+2*t*Math.PI/3),i[3*t+1]=this.size*Math.sin(Math.PI+2*t*Math.PI/3),i[3*t+2]=0,o[3*t]=0,o[3*t+1]=0,o[3*t+2]=1;var s=1.5*this.size;for(t=3;t<6;t++)i[3*t]=s+this.size*Math.cos(Math.PI+2*t*Math.PI/3),i[3*t+1]=this.size*Math.sin(Math.PI+2*t*Math.PI/3),i[3*t+2]=0,o[3*t]=0,o[3*t+1]=0,o[3*t+2]=1;var n=-this.size-this.width,r=this.size*Math.sin(2*Math.PI/3);i[3*t]=n,i[3*t+1]=r,i[3*t+2]=0,o[3*t]=0,o[3*t+1]=0,o[3*t+2]=1,t++,i[3*t]=n+this.width,i[3*t+1]=r,i[3*t+2]=0,o[3*t]=0,o[3*t+1]=0,o[3*t+2]=1,t++,i[3*t]=n+this.width,i[3*t+1]=-r,i[3*t+2]=0,o[3*t]=0,o[3*t+1]=0,o[3*t+2]=1,t++,i[3*t]=n,i[3*t+1]=-r,i[3*t+2]=0,o[3*t]=0,o[3*t+1]=0,o[3*t+2]=1;var a=new Uint16Array(12),h=0;a[h++]=0,a[h++]=1,a[h++]=2,a[h++]=3,a[h++]=4,a[h++]=5,a[h++]=8,a[h++]=7,a[h++]=6,a[h++]=9,a[h++]=8,a[h++]=6,e.addAttribute("index",new THREE.BufferAttribute(a,1)),e.addAttribute("position",new THREE.BufferAttribute(i,3)),e.addAttribute("normal",new THREE.BufferAttribute(o,3));var l=new THREE.Mesh(e,null);return l},t.prototype.createNextButton=function(){var t,e=new THREE.BufferGeometry,i=new Float32Array(21),o=new Float32Array(21);for(t=0;t<3;t++)i[3*t]=this.size*Math.cos(2*t*Math.PI/3),i[3*t+1]=this.size*Math.sin(2*t*Math.PI/3),i[3*t+2]=0,o[3*t]=0,o[3*t+1]=0,o[3*t+2]=1;var s=this.size,n=this.size*Math.sin(2*Math.PI/3);i[3*t]=s,i[3*t+1]=n,i[3*t+2]=0,o[3*t]=0,o[3*t+1]=0,o[3*t+2]=1,t++,i[3*t]=s+this.width,i[3*t+1]=n,i[3*t+2]=0,o[3*t]=0,o[3*t+1]=0,o[3*t+2]=1,t++,i[3*t]=s+this.width,i[3*t+1]=-n,i[3*t+2]=0,o[3*t]=0,o[3*t+1]=0,o[3*t+2]=1,t++,i[3*t]=s,i[3*t+1]=-n,i[3*t+2]=0,o[3*t]=0,o[3*t+1]=0,o[3*t+2]=1;var r=new Uint16Array(9),a=0;r[a++]=0,r[a++]=1,r[a++]=2,r[a++]=5,r[a++]=4,r[a++]=3,r[a++]=6,r[a++]=5,r[a++]=3,e.addAttribute("index",new THREE.BufferAttribute(r,1)),e.addAttribute("position",new THREE.BufferAttribute(i,3)),e.addAttribute("normal",new THREE.BufferAttribute(o,3));var h=new THREE.Mesh(e,null);return h},t.prototype.createPauseButton=function(){var t=new THREE.BufferGeometry,e=new Float32Array(24),i=new Float32Array(24),o=this.size,s=2*this.size*Math.sin(2*Math.PI/3),n=1.5*this.size/3,r=0;e[3*r]=-o/2,e[3*r+1]=s/2,e[3*r+2]=0,i[3*r]=0,i[3*r+1]=0,i[3*r+2]=1,r++,e[3*r]=-o/2+n,e[3*r+1]=s/2,e[3*r+2]=0,i[3*r]=0,i[3*r+1]=0,i[3*r+2]=1,r++,e[3*r]=-o/2+n,e[3*r+1]=-s/2,e[3*r+2]=0,i[3*r]=0,i[3*r+1]=0,i[3*r+2]=1,r++,e[3*r]=-o/2,e[3*r+1]=-s/2,e[3*r+2]=0,i[3*r]=0,i[3*r+1]=0,i[3*r+2]=1,r++,e[3*r]=-o/2+2*n,e[3*r+1]=s/2,e[3*r+2]=0,i[3*r]=0,i[3*r+1]=0,i[3*r+2]=1,r++,e[3*r]=-o/2+n+2*n,e[3*r+1]=s/2,e[3*r+2]=0,i[3*r]=0,i[3*r+1]=0,i[3*r+2]=1,r++,e[3*r]=-o/2+n+2*n,e[3*r+1]=-s/2,e[3*r+2]=0,i[3*r]=0,i[3*r+1]=0,i[3*r+2]=1,r++,e[3*r]=-o/2+2*n,e[3*r+1]=-s/2,e[3*r+2]=0,i[3*r]=0,i[3*r+1]=0,i[3*r+2]=1,r++;var a=new Uint16Array(12),h=0;a[h++]=2,a[h++]=1,a[h++]=0,a[h++]=3,a[h++]=2,a[h++]=0,a[h++]=6,a[h++]=5,a[h++]=4,a[h++]=7,a[h++]=6,a[h++]=4,t.addAttribute("index",new THREE.BufferAttribute(a,1)),t.addAttribute("position",new THREE.BufferAttribute(e,3)),t.addAttribute("normal",new THREE.BufferAttribute(i,3));var l=new THREE.Mesh(t,null);return l},t}),define("cube/Tile3D",[],function(){"use strict";THREE.MyPlaneBufferGeometry=function(t,e,i,o,s){THREE.BufferGeometry.call(this),this.type="MyPlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:o};for(var n,r,a=t/2,h=e/2,l=i||1,c=o||1,u=l+1,m=c+1,d=t/l,p=e/c,f=new Float32Array(u*m*3),y=new Float32Array(u*m*3),g=new Float32Array(u*m*2),w=0,v=0,x=0;x<m;x++)for(var b=x*p-h,E=0;E<u;E++){var M=E*d-a;f[w]=M,f[w+1]=-b,y[w+2]=1,n=E/l,r=1-x/c,g[v]=s.origin.x+s.u.x*n+s.v.x*r,g[v+1]=s.origin.y+s.u.y*n+s.v.y*r,w+=3,v+=2}w=0;for(var z=new(f.length/3>65535?Uint32Array:Uint16Array)(l*c*6),x=0;x<c;x++)for(var E=0;E<l;E++){var T=E+u*x,R=E+u*(x+1),H=E+1+u*(x+1),A=E+1+u*x;z[w]=T,z[w+1]=R,z[w+2]=A,z[w+3]=R,z[w+4]=H,z[w+5]=A,w+=6}this.addAttribute("index",new THREE.BufferAttribute(z,1)),this.addAttribute("position",new THREE.BufferAttribute(f,3)),this.addAttribute("normal",new THREE.BufferAttribute(y,3)),this.addAttribute("uv",new THREE.BufferAttribute(g,2))},THREE.MyPlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.MyPlaneBufferGeometry.prototype.constructor=THREE.MyPlaneBufferGeometry;var t=function(t,e,i,o,s){this.position={x:t[0],y:t[1],z:t[2]},this.normal={x:e[0],y:e[1],z:e[2]},this.cube3d=o;var n=o.size,r={origin:{x:s.origin.x+i[0]*s.u.x+i[1]*s.v.x,y:s.origin.y+i[0]*s.u.y+i[1]*s.v.y},u:s.u,v:s.v};this.backGeometry=new THREE.MyPlaneBufferGeometry(n,n,1,1,r),this.stickerGeometry=new THREE.MyPlaneBufferGeometry(.95*n,.95*n,1,1,r),this.mesh=new THREE.Mesh(this.stickerGeometry,null),this.mesh.position.set(0,0,.01*n),this.backMesh=new THREE.Mesh(this.backGeometry,null),this.cube3d.materials.space.side=THREE.DoubleSide,this.backMesh.material=this.cube3d.materials.space,this.mesh.mytile=this;var a=new THREE.Vector3(this.normal.x,this.normal.y,this.normal.z),h=new THREE.Vector3(0,0,1),l=new THREE.Quaternion;l.setFromUnitVectors(h,a);var c=this.normal.z<0?-1:1;this.invertX=this.normal.z<0,this.subnode0=new THREE.Object3D,this.subnode0.setRotationFromQuaternion(l),this.subnode0.add(this.mesh),this.subnode0.add(this.backMesh);var u=new THREE.Object3D;u.position.set(n*(c*this.position.x+.5*this.normal.x),n*(this.position.y+.5*this.normal.y),n*(this.position.z+.5*this.normal.z)),u.add(this.subnode0),this.node=new THREE.Object3D,this.node.add(u)};return t.prototype.setTile=function(t){if(t.mesh)t.mesh!==this.mesh&&(this.subnode0.remove(this.mesh),this.subnode0.add(t.mesh),this.mesh=t.mesh,this.mesh.mytile=this);else if(t.mesh=this.mesh,t.id){var e=this.cube3d.skin[t.id];this.mesh.material=this.cube3d.materials[e]}else this.mesh.material=this.cube3d.materials[t.color];this.normal.z<-.5?this.mesh.rotation.set(0,0,t.rotation*Math.PI/180+Math.PI):this.mesh.rotation.set(0,0,t.rotation*Math.PI/180)},t.prototype.normalEquals=function(t,e){if(t[0]===this.normal.x&&t[1]===this.normal.y&&t[2]===this.normal.z)return!0;if(this.invertX){if(t[0]>0&&this.position.x<0)return!0;if(t[0]<0&&this.position.x>0)return!0}else{if(t[0]>0&&this.position.x>0)return!0;if(t[0]<0&&this.position.x<0)return!0}if(t[1]>0&&this.position.y>0)return!0;if(t[1]<0&&this.position.y<0)return!0;if(t[2]>0&&this.position.z>0)return!0;if(t[2]<0&&this.position.z<0)return!0;if(e){if(0!==t[0]&&0===this.position.x)return!0;if(0!==t[1]&&0===this.position.y)return!0;if(0!==t[2]&&0===this.position.z)return!0}return!1},t}),define("cube/CubeTexCoords",[],function(){"use strict";var t={origin:{x:0,y:0},u:{x:1/3,y:0},v:{x:0,y:1/3}},e=function(){this.uvFrames={}};return e.prototype.addFace=function(t,e){this.uvFrames[t]=e},e.prototype.getFaceUvBounds=function(e){return this.uvFrames[e]||t},e}),define("cube/Tile",[],function(){"use strict";var t=function(t){this.id=t.id,this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.mesh=t.mesh,this.alwaysSolved=t.alwaysSolved||!1,this.color=t.color};return t.prototype.setIgnoreInSolution=function(t){this.alwaysSolved=t},t.prototype.clone=function(){return new t(this)},t.prototype.rotate=function(t){this.rotation=(this.rotation+t)%360,this.rotation<0&&(this.rotation+=360)},t}),define("cube/Face",["cube/Tile"],function(t){"use strict";function e(t,e){return 0===e?[t[0],t[1]]:90===e?[-t[1],t[0]]:180===e?[-t[0],-t[1]]:e===-90?[t[1],-t[0]]:void 0}var i=function(t){this.id=t,this.neighbors={},this.tiles=[[null,null,null],[null,null,null],[null,null,null]]};return i.prototype.addNeighbor=function(t,e,i){this.neighbors[t]={face:e,angle:i}},i.prototype.getEdge=function(t){var e;for(e in this.neighbors)if(this.neighbors[e].face===t)return e},i.prototype.getNeighbor=function(t){var e;for(e in this.neighbors)if(this.neighbors[e].face===t)return this.neighbors[e]},i.prototype.getTile=function(t,e){return this.tiles[e+1][t+1]},i.prototype.setTile=function(t,e,i){this.tiles[e+1][t+1]=i},i.prototype.getCenter=function(t,e){return this.tiles[1][1]},i.prototype.fillFromString=function(e,i){var o,s,n,r=0,a=0,h=0;for(r=0;r<9;r++)o=i[e.charAt(r)],s=r%3-1,n=Math.floor(r/3)-1,this.setTile(s,n,new t({color:o,x:a,y:h,rotation:0}))},i.prototype.getFillString=function(){var t,e=0,i="";for(e=0;e<9;e++)t=this.getTile(e%3-1,Math.floor(e/3)-1),i+=t.color[0];return i},i.prototype.getNeighborEdgeTiles=function(t){var e,o=this.neighbors[t].face,s=o.getEdge(this),n=i.edgesTiles[s],r=0,a=[];for(r=0;r<n.length;r++)e=o.getTile(n[r][0],n[r][1]),a.push(e);return a},i.prototype.getNeighborEdgeString=function(t){var e,o="",s=i.getNeighborEdgeTiles(t);for(e=0;e<s.length;e++)o+=s[e].color[0];return o},i.prototype.fill=function(e){function i(t){n.setTile(t.x,t.y,t)}var o,s,n=this;for(o=-1;o<=1;o++)for(s=-1;s<=1;s++)i(new t({color:e,id:this.id,x:o,y:s,rotation:0}))},i.prototype.rotate=function(t,e){var i,o,s,n,r,a,h=t>0?1:-1,l=t>0?-1:1,c=e.faces[this.id];for(i=-1;i<=1;i++)for(o=-1;o<=1;o++)s=h*o,n=l*i,r=this.getTile(i,o),a=r.clone(),a.rotate(t*-90),c.setTile(s,n,a)},i.edgesTiles={up:[[-1,1],[0,1],[1,1]],right:[[1,1],[1,0],[1,-1]],down:[[1,-1],[0,-1],[-1,-1]],left:[[-1,-1],[-1,0],[-1,1]]},i.prototype.pushEdge=function(t,o,s){var n,r,a,h,l=i.edgesTiles[t],c=this.getNeighborInEdgeDirection(t,o),u=s.faces[c.face.id],m=c.angle;for(n in l)r=this.getTile(l[n][0],l[n][1]),a=e(l[n],m),h=r.clone(),h.rotate(m),u.setTile(a[0],a[1],h)},i.prototype.pushAll=function(t,i){var o,s,n,r,a,h=this.getNeighbor(t),l=i.faces[h.face.id];for(o=-1;o<=1;o++)for(s=-1;s<=1;s++)n=this.getTile(o,s),r=n.clone(),r.rotate(h.angle),a=e([o,s],h.angle),l.setTile(a[0],a[1],r)},i.prototype.getNeighborInEdgeDirection=function(t,e){var i={1:{up:"right",right:"down",down:"left",left:"up"},"-1":{up:"left",right:"up",down:"right",left:"down"}},o=i[e][t];return this.neighbors[o]},i.prototype.copyTo=function(t){var e,i;for(e=-1;e<=1;e++)for(i=-1;i<=1;i++)t.setTile(e,i,this.getTile(e,i).clone())},i.prototype.isSolved=function(t){var e,i,o,e,s=this.tiles[1][1].id,n=this.tiles[1][1].rotation;for(i=0;i<this.tiles.length;i++)for(o=0;o<this.tiles[i].length;o++){var e=this.tiles[i][o];if(!e.alwaysSolved&&(e.id!==s||t&&e.rotation!==n))return!1}return!0},i}),define("cube/Cube",["cube/Face"],function(t){"use strict";function e(t){var e,i={};for(e in t)i[t[e]]=e;return i}var i=function(e){this.faces={front:new t("front"),back:new t("back"),up:new t("up"),down:new t("down"),right:new t("right"),left:new t("left")},this.faces.front.addNeighbor("up",this.faces.up,0),this.faces.front.addNeighbor("down",this.faces.down,0),this.faces.front.addNeighbor("right",this.faces.right,0),this.faces.front.addNeighbor("left",this.faces.left,0),this.faces.up.addNeighbor("up",this.faces.back,0),this.faces.up.addNeighbor("down",this.faces.front,0),this.faces.up.addNeighbor("right",this.faces.right,-90),this.faces.up.addNeighbor("left",this.faces.left,90),this.faces.back.addNeighbor("up",this.faces.down,0),this.faces.back.addNeighbor("down",this.faces.up,0),this.faces.back.addNeighbor("right",this.faces.right,180),this.faces.back.addNeighbor("left",this.faces.left,180),this.faces.down.addNeighbor("up",this.faces.front,0),this.faces.down.addNeighbor("down",this.faces.back,0),this.faces.down.addNeighbor("right",this.faces.right,90),this.faces.down.addNeighbor("left",this.faces.left,-90),this.faces.right.addNeighbor("up",this.faces.up,90),this.faces.right.addNeighbor("down",this.faces.down,-90),this.faces.right.addNeighbor("right",this.faces.back,180),this.faces.right.addNeighbor("left",this.faces.front,0),this.faces.left.addNeighbor("up",this.faces.up,-90),this.faces.left.addNeighbor("down",this.faces.down,90),this.faces.left.addNeighbor("right",this.faces.front,0),this.faces.left.addNeighbor("left",this.faces.back,180),e&&e.empty||this.fill()},o=["front","back","up","down","right","left"],s={r:"red",o:"orange",y:"yellow",w:"white",g:"green",b:"blue",_:"gray"},n=e(s);return i.prototype.fillFromString=function(t){var e=9;t.length!==6*e&&console.log("Invalid cube config");var i;for(i=0;i<o.length;i++)this.faces[o[i]].fillFromString(t.substring(i*e,(i+1)*e),s)},i.prototype.getFillString=function(){var t,e="";for(t=0;t<o.length;t++)e+=this.faces[o[t]].getFillString(n);return e},i.prototype.fill=function(){this.faces.front.fill("red"),this.faces.back.fill("orange"),this.faces.up.fill("yellow"),this.faces.down.fill("white"),this.faces.right.fill("green"),this.faces.left.fill("blue")},i.prototype.getTile=function(t,e){var i,o,s;return 1===e.z?(i="front",o=t.x,s=t.y):e.z===-1?(i="back",o=-t.x,s=-t.y):1===e.x?(i="right",o=-t.z,s=t.y):e.x===-1?(i="left",o=t.z,s=t.y):1===e.y?(i="up",o=t.x,s=-t.z):e.y===-1&&(i="down",o=t.x,s=t.z),this.faces[i].getTile(o,s)},i.prototype.clone=function(){var t,e=new i;for(t in this.faces)this.faces[t].copyTo(e.faces[t]);return e},i.prototype.rotate=function(t,e,i){var o=this.faces[t];o.rotate(e,i);var s,n,r,a=["up","down","right","left"];for(s=0;s<a.length;s++)n=o.neighbors[a[s]].face,r=n.getEdge(o),n.pushEdge(r,-e,i);return i},i.prototype.rotateAll=function(t,e,i){var o={x:{rotate:["right","left"],permute:["front","up","back","down"]},y:{rotate:["up","down"],permute:["right","front","left","back"]},z:{rotate:["front","back"],permute:["up","right","down","left"]}};this.faces[o[t].rotate[0]].rotate(e,i),this.faces[o[t].rotate[1]].rotate(-1*e,i);var s,n,r,a,h=o[t].permute;for(s=0;s<h.length;s++)r=h[s],n=s+e,n<0&&(n+=h.length),n%=h.length,a=h[n],this.faces[r].pushAll(this.faces[a],i)},i.prototype.scramble=function(){var t,e=0,i=this,s=1e3;for(e=0;e<s;e++){t=i.clone();var n=Math.floor(6*Math.random()),r=Math.random()<.5?-1:1;i.rotate(o[n],r,t),i=t}return i},i.prototype.executeCommand=function(t){var e=i.commandTable[t],o=this.clone();if(e.face)if(e.dual){this.rotate(i.oppositeFace[e.face],e.direction,o);var s=o.clone(),n=i.faceToAxis[e.face];o.rotateAll(n.axis,n.direction*e.direction,s),o=s}else this.rotate(e.face,e.direction,o);else this.rotateAll(e.axis,e.direction,o);return o},i.prototype.executeCommands=function(t){var e,i=this;for(e=0;e<t.length;e++)i=i.executeCommand(t[e]);return i},i.prototype.isSolved=function(t,e){var i;for(i in this.faces)if(!this.faces[i].isSolved(t))return!1;if(e){var o=this.faces.up.getCenter();if(o.color!==e)return!1}return!0},i.commandTable={U:{face:"up",direction:1},D:{face:"down",direction:1},F:{face:"front",direction:1},B:{face:"back",direction:1},L:{face:"left",direction:1},R:{face:"right",direction:1},"U'":{face:"up",direction:-1},"D'":{face:"down",direction:-1},"F'":{face:"front",direction:-1},"B'":{face:"back",direction:-1},"L'":{face:"left",direction:-1},"R'":{face:"right",direction:-1},x:{axis:"x",direction:1},y:{axis:"y",direction:1},z:{axis:"z",direction:1},"x'":{axis:"x",direction:-1},"y'":{axis:"y",direction:-1},"z'":{axis:"z",direction:-1},u:{face:"up",direction:1,dual:!0},d:{face:"down",direction:1,dual:!0},f:{face:"front",direction:1,dual:!0},b:{face:"back",direction:1,dual:!0},l:{face:"left",direction:1,dual:!0},r:{face:"right",direction:1,dual:!0},"u'":{face:"up",direction:-1,dual:!0},"d'":{face:"down",direction:-1,dual:!0},"f'":{face:"front",direction:-1,dual:!0},"b'":{face:"back",direction:-1,dual:!0},"l'":{face:"left",direction:-1,dual:!0},"r'":{face:"right",direction:-1,dual:!0}},i.faceToNormal={up:[0,1,0],down:[0,-1,0],front:[0,0,1],back:[0,0,-1],right:[1,0,0],left:[-1,0,0]},i.axisToNormal={x:[1,0,0],y:[0,1,0],z:[0,0,1]},i.oppositeFace={up:"down",down:"up",right:"left",left:"right",back:"front",front:"back"},i.faceToAxis={up:{axis:"y",direction:1},down:{axis:"y",direction:-1},right:{axis:"x",direction:1},left:{axis:"x",direction:-1},front:{axis:"z",direction:1},back:{axis:"z",direction:-1}},i}),define("cube/Cube3D",["cube/Tile3D","cube/Cube","cube/CubeTexCoords"],function(t,e,i){"use strict";var o=function(e){this.size=e.size,this.cube=e.cube,this.cubeTexCoords=e.cubeTexCoords||new i,this.tiles=[],this.materials=e.materials||{white:new THREE.MeshBasicMaterial({color:16777215}),yellow:new THREE.MeshBasicMaterial({color:16776960}),blue:new THREE.MeshBasicMaterial({color:255}),green:new THREE.MeshBasicMaterial({color:65280}),red:new THREE.MeshBasicMaterial({color:16711680}),orange:new THREE.MeshBasicMaterial({color:16746496}),gray:new THREE.MeshBasicMaterial({color:"gray"}),space:new THREE.MeshBasicMaterial({color:"#dddddd"})},this.skin=e.skin||{down:"white",up:"yellow",back:"orange",front:"red",left:"blue",right:"green"};var o;o=this.cubeTexCoords.getFaceUvBounds("right"),this.tiles.push(new t([1,-1,-1],[1,0,0],[2,0],this,o)),this.tiles.push(new t([1,-1,0],[1,0,0],[1,0],this,o)),this.tiles.push(new t([1,-1,1],[1,0,0],[0,0],this,o)),this.tiles.push(new t([1,0,-1],[1,0,0],[2,1],this,o)),this.tiles.push(new t([1,0,0],[1,0,0],[1,1],this,o)),this.tiles.push(new t([1,0,1],[1,0,0],[0,1],this,o)),this.tiles.push(new t([1,1,-1],[1,0,0],[2,2],this,o)),this.tiles.push(new t([1,1,0],[1,0,0],[1,2],this,o)),this.tiles.push(new t([1,1,1],[1,0,0],[0,2],this,o)),o=this.cubeTexCoords.getFaceUvBounds("left"),this.tiles.push(new t([-1,-1,-1],[-1,0,0],[0,0],this,o)),this.tiles.push(new t([-1,-1,0],[-1,0,0],[1,0],this,o)),this.tiles.push(new t([-1,-1,1],[-1,0,0],[2,0],this,o)),this.tiles.push(new t([-1,0,-1],[-1,0,0],[0,1],this,o)),this.tiles.push(new t([-1,0,0],[-1,0,0],[1,1],this,o)),this.tiles.push(new t([-1,0,1],[-1,0,0],[2,1],this,o)),this.tiles.push(new t([-1,1,-1],[-1,0,0],[0,2],this,o)),this.tiles.push(new t([-1,1,0],[-1,0,0],[1,2],this,o)),this.tiles.push(new t([-1,1,1],[-1,0,0],[2,2],this,o)),o=this.cubeTexCoords.getFaceUvBounds("up"),this.tiles.push(new t([-1,1,-1],[0,1,0],[0,2],this,o)),this.tiles.push(new t([-1,1,0],[0,1,0],[0,1],this,o)),this.tiles.push(new t([-1,1,1],[0,1,0],[0,0],this,o)),this.tiles.push(new t([0,1,-1],[0,1,0],[1,2],this,o)),this.tiles.push(new t([0,1,0],[0,1,0],[1,1],this,o)),this.tiles.push(new t([0,1,1],[0,1,0],[1,0],this,o)),this.tiles.push(new t([1,1,-1],[0,1,0],[2,2],this,o)),this.tiles.push(new t([1,1,0],[0,1,0],[2,1],this,o)),this.tiles.push(new t([1,1,1],[0,1,0],[2,0],this,o)),o=this.cubeTexCoords.getFaceUvBounds("down"),this.tiles.push(new t([-1,-1,-1],[0,-1,0],[0,0],this,o)),this.tiles.push(new t([-1,-1,0],[0,-1,0],[0,1],this,o)),this.tiles.push(new t([-1,-1,1],[0,-1,0],[0,2],this,o)),this.tiles.push(new t([0,-1,-1],[0,-1,0],[1,0],this,o)),this.tiles.push(new t([0,-1,0],[0,-1,0],[1,1],this,o)),this.tiles.push(new t([0,-1,1],[0,-1,0],[1,2],this,o)),this.tiles.push(new t([1,-1,-1],[0,-1,0],[2,0],this,o)),this.tiles.push(new t([1,-1,0],[0,-1,0],[2,1],this,o)),this.tiles.push(new t([1,-1,1],[0,-1,0],[2,2],this,o)),o=this.cubeTexCoords.getFaceUvBounds("front"),this.tiles.push(new t([-1,-1,1],[0,0,1],[0,0],this,o)),this.tiles.push(new t([0,-1,1],[0,0,1],[1,0],this,o)),this.tiles.push(new t([1,-1,1],[0,0,1],[2,0],this,o)),this.tiles.push(new t([-1,0,1],[0,0,1],[0,1],this,o)),this.tiles.push(new t([0,0,1],[0,0,1],[1,1],this,o)),this.tiles.push(new t([1,0,1],[0,0,1],[2,1],this,o)),this.tiles.push(new t([-1,1,1],[0,0,1],[0,2],this,o)),this.tiles.push(new t([0,1,1],[0,0,1],[1,2],this,o)),this.tiles.push(new t([1,1,1],[0,0,1],[2,2],this,o)),o=this.cubeTexCoords.getFaceUvBounds("back"),this.tiles.push(new t([-1,-1,-1],[0,0,-1],[2,2],this,o)),this.tiles.push(new t([0,-1,-1],[0,0,-1],[1,2],this,o)),this.tiles.push(new t([1,-1,-1],[0,0,-1],[0,2],this,o)),this.tiles.push(new t([-1,0,-1],[0,0,-1],[2,1],this,o)),this.tiles.push(new t([0,0,-1],[0,0,-1],[1,1],this,o)),this.tiles.push(new t([1,0,-1],[0,0,-1],[0,1],this,o)),this.tiles.push(new t([-1,1,-1],[0,0,-1],[2,0],this,o)),this.tiles.push(new t([0,1,-1],[0,0,-1],[1,0],this,o)),this.tiles.push(new t([1,1,-1],[0,0,-1],[0,0],this,o)),this.node=new THREE.Object3D,this.meshes=[];var s;for(s=0;s<this.tiles.length;s++)this.node.add(this.tiles[s].node),this.meshes.push(this.tiles[s].mesh);this.command=null,this.commandK=null,this.setFromCube(this.cube),this.instantMode=!1,this.history=[]};return o.prototype.getMeshes=function(){return this.meshes},o.prototype.setFromCube=function(t){var e,i,o;for(e=0;e<this.tiles.length;e++)o=this.tiles[e],i=t.getTile(o.position,o.normal),o.setTile(i)},o.prototype.addToScene=function(t){var e;for(e=0;e<this.tiles.length;e++)t.add(this.tiles[e].mesh)},o.prototype.rotateTo=function(t,e,i){var o,s,n=new THREE.Vector3(t[0],t[1],t[2]);for(o=0;o<this.tiles.length;o++)s=this.tiles[o],s.normalEquals(t,i)&&s.node.setRotationFromAxisAngle(n,e)},o.prototype.rotateAllTo=function(t,e){var i,o,s=new THREE.Vector3(t[0],t[1],t[2]);for(i=0;i<this.tiles.length;i++)o=this.tiles[i],o.node.setRotationFromAxisAngle(s,e)},o.prototype.resetPosition=function(){var t,e;for(t=0;t<this.tiles.length;t++)e=this.tiles[t],e.node.setRotationFromQuaternion(new THREE.Quaternion)},o.commandTable=e.commandTable,o.faceToNormal=e.faceToNormal,o.axisToNormal=e.axisToNormal,o.oppositeFace=e.oppositeFace,o.faceToAxis=e.faceToAxis,o.prototype.startCommand=function(t){"0"===t||"1"===t?(this.instantMode=!this.instantMode,"1"===t&&this.node.rotation.set(0,0,0)):this.history.push(t),this.currentCommand=o.commandTable[t],this.commandK=this.instantMode?1:0},o.prototype.continueCommand=function(t,e){if(this.currentCommand)if(this.commandK+=t/1e3,this.commandK>=1){this.resetPosition();var i=this.cube.clone();if(this.currentCommand.face)if(this.currentCommand.dual){this.cube.rotate(o.oppositeFace[this.currentCommand.face],this.currentCommand.direction,i);var s=i.clone(),n=o.faceToAxis[this.currentCommand.face];i.rotateAll(n.axis,n.direction*this.currentCommand.direction,s),i=s}else this.cube.rotate(this.currentCommand.face,this.currentCommand.direction,i);else this.cube.rotateAll(this.currentCommand.axis,this.currentCommand.direction,i);this.cube=i,this.setFromCube(this.cube),this.currentCommand=null,this.commandK=null,e()}else this.currentCommand.face?this.rotateTo(o.faceToNormal[this.currentCommand.face],-1*this.currentCommand.direction*this.commandK*Math.PI/2,this.currentCommand.dual):this.rotateAllTo(o.axisToNormal[this.currentCommand.axis],-1*this.currentCommand.direction*this.commandK*Math.PI/2);else e()},o}),define("scene/Scene",["cube/Cube","cube/Cube3D","cube/Interpreter","scene/Arrow","scene/ArrowMaterial"],function(t,e,i,o,s){"use strict";var n=function(i){i=i||{};var o=i.width,n=i.height,r=i.init,a=i.fill,h=i.scramble,l=i.cubeMaterials,c=i.cubeTexCoords,u=i.backgroundColor;this.frameIndex=1e3,this.width=o,this.height=n,this.init=r?r:"",this.scene=new THREE.Scene;var m=.011;this.camera=new THREE.OrthographicCamera(m*-480/2,480*m/2,480*m/2,m*-480/2,-100,100),this.camera.position.set(4,4,4),this.camera.up=new THREE.Vector3(0,1,0),this.camera.lookAt(new THREE.Vector3(0,0,0)),this.stopAnimation=!0,this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setClearColor(new THREE.Color(u),1),this.renderer.setSize(this.width,this.height),this.domElement=this.renderer.domElement;var d=new THREE.DirectionalLight(16777215,1);d.position.set(1,1,.5),this.scene.add(d);var p=new THREE.DirectionalLight(16777215,.5);p.position.set(-1,-1,.5),this.scene.add(p),this.cube3d=new e({size:1,cube:new t,cubeTexCoords:c,materials:l}),a?cube.fillFromString(a):h&&(this.cube3d.cube=this.cube3d.cube.scramble()),this.cube3d.setFromCube(this.cube3d.cube),this.scene.add(this.cube3d.node),this.cameraMove=null,this.commandQueue=[];var f=window.rootDir||"";this.texArrow=THREE.ImageUtils.loadTexture(f+"img/arrow.png"),this.texArrow.minFilter=THREE.NearestFilter,this.texArrow.magFilter=THREE.NearestFilter,this.texRoundArrow=THREE.ImageUtils.loadTexture(f+"img/roundarrow.png"),this.texRoundArrow.minFilter=THREE.NearestFilter,this.texRoundArrow.magFilter=THREE.NearestFilter,this.texArrowHL=THREE.ImageUtils.loadTexture(f+"img/arrowhl.png"),this.straightArrowMaterial=new s({map:this.texArrow}),this.roundArrowMaterial=new s({map:this.texRoundArrow}),this.position="up",this.createArrows()};n.prototype.createArrows=function(){var t,e=1.375,i=.25,s=[{position:{x:1,y:1,z:-e},normal:{x:0,y:1,z:0},command:"R",angle:0},{position:{x:i,y:1,z:-e},normal:{x:0,y:1,z:0},command:"r",angle:0,twinWithPrevious:!0},{position:{x:1,y:1,z:e},normal:{x:0,y:1,z:0},command:"R'",angle:180},{position:{x:i,y:1,z:e},normal:{x:0,y:1,z:0},command:"r'",angle:180,twinWithPrevious:!0},{position:{x:-1,y:1,z:-e},normal:{x:0,y:1,z:0},command:"L'",angle:0},{position:{x:-i,y:1,z:-e},normal:{x:0,y:1,z:0},command:"l'",angle:0,twinWithPrevious:!0},{position:{x:-1,y:1,z:e},normal:{x:0,y:1,z:0},command:"L",angle:180},{position:{x:-i,y:1,z:e},normal:{x:0,y:1,z:0},command:"l",angle:180,twinWithPrevious:!0},{position:{x:e,y:1,z:-1},normal:{x:0,y:1,z:0},command:"B'",angle:-90},{position:{x:e,y:1,z:-i},normal:{x:0,y:1,z:0},command:"b'",angle:-90,twinWithPrevious:!0},{position:{x:e,y:1,z:1},normal:{x:0,y:1,z:0},command:"F",angle:-90},{position:{x:e,y:1,z:i},normal:{x:0,y:1,z:0},command:"f",angle:-90,twinWithPrevious:!0},{position:{x:-e,y:1,z:-1},normal:{x:0,y:1,z:0},command:"B",angle:90},{position:{x:-e,y:1,z:-i},normal:{x:0,y:1,z:0},command:"b",angle:90,twinWithPrevious:!0},{position:{x:-e,y:1,z:1},normal:{x:0,y:1,z:0},command:"F'",angle:90},{position:{x:-e,y:1,z:i},normal:{x:0,y:1,z:0},command:"f'",angle:90,twinWithPrevious:!0},{position:{x:1,y:e,z:1},normal:{x:1,y:0,z:0},command:"F'",angle:0},{position:{x:1,y:e,z:i},normal:{x:1,y:0,z:0},command:"f'",angle:0,twinWithPrevious:!0},{position:{x:1,y:-e,z:1},normal:{x:1,y:0,z:0},command:"F",angle:180},{position:{x:1,y:-e,z:i},normal:{x:1,y:0,z:0},command:"f",angle:180,twinWithPrevious:!0},{position:{x:1,y:e,z:-1},normal:{x:1,y:0,z:0},command:"B",angle:0},{position:{x:1,y:e,z:-i},normal:{x:1,y:0,z:0},command:"b",angle:0,twinWithPrevious:!0},{position:{x:1,y:-e,z:-1},normal:{x:1,y:0,z:0},command:"B'",angle:180},{position:{x:1,y:-e,z:-i},normal:{x:1,y:0,z:0},command:"b'",angle:180,twinWithPrevious:!0},{position:{x:1,y:1,z:e},normal:{x:1,y:0,z:0},command:"U",angle:90},{position:{x:1,y:i,z:e},normal:{x:1,y:0,z:0},command:"u",angle:90,twinWithPrevious:!0},{position:{x:1,y:-1,z:e},normal:{x:1,y:0,z:0},command:"D'",angle:90},{position:{x:1,y:-i,z:e},normal:{x:1,y:0,z:0},command:"d'",angle:90,twinWithPrevious:!0},{position:{x:1,y:1,z:-e},normal:{x:1,y:0,z:0},command:"U'",angle:-90},{position:{x:1,y:i,z:-e},normal:{x:1,y:0,z:0},command:"u'",angle:-90,twinWithPrevious:!0},{position:{x:1,y:-1,z:-e},normal:{x:1,y:0,z:0},command:"D",angle:-90},{position:{x:1,y:-i,z:-e},normal:{x:1,y:0,z:0},command:"d",angle:-90,twinWithPrevious:!0},{position:{x:e,y:1,z:1},normal:{x:0,y:0,z:1},command:"U'",angle:-90},{position:{x:e,y:i,z:1},normal:{x:0,y:0,z:1},command:"u'",angle:-90,twinWithPrevious:!0},{position:{x:-e,y:1,z:1},normal:{x:0,y:0,z:1},command:"U",angle:90},{position:{x:-e,y:i,z:1},normal:{x:0,y:0,z:1},command:"u",angle:90,twinWithPrevious:!0},{position:{x:e,y:-1,z:1},normal:{x:0,y:0,z:1},command:"D",angle:-90},{position:{x:e,y:-i,z:1},normal:{x:0,y:0,z:1},command:"d",angle:-90,twinWithPrevious:!0},{position:{x:-e,y:-1,z:1},normal:{x:0,y:0,z:1},command:"D'",angle:90},{position:{x:-e,y:-i,z:1},normal:{x:0,y:0,z:1},command:"d'",angle:90,twinWithPrevious:!0},{
position:{x:1,y:e,z:1},normal:{x:0,y:0,z:1},command:"R",angle:0},{position:{x:i,y:e,z:1},normal:{x:0,y:0,z:1},command:"r",angle:0,twinWithPrevious:!0},{position:{x:-1,y:e,z:1},normal:{x:0,y:0,z:1},command:"L'",angle:0},{position:{x:-i,y:e,z:1},normal:{x:0,y:0,z:1},command:"l'",angle:0,twinWithPrevious:!0},{position:{x:1,y:-e,z:1},normal:{x:0,y:0,z:1},command:"R'",angle:180},{position:{x:i,y:-e,z:1},normal:{x:0,y:0,z:1},command:"r'",angle:180,twinWithPrevious:!0},{position:{x:-1,y:-e,z:1},normal:{x:0,y:0,z:1},command:"L",angle:180},{position:{x:-i,y:-e,z:1},normal:{x:0,y:0,z:1},command:"l",angle:180,twinWithPrevious:!0},{position:{x:1,y:-1,z:-e},normal:{x:0,y:-1,z:0},command:"R'",angle:180},{position:{x:i,y:-1,z:-e},normal:{x:0,y:-1,z:0},command:"r'",angle:180,twinWithPrevious:!0},{position:{x:1,y:-1,z:e},normal:{x:0,y:-1,z:0},command:"R",angle:0},{position:{x:i,y:-1,z:e},normal:{x:0,y:-1,z:0},command:"r",angle:0,twinWithPrevious:!0},{position:{x:-1,y:-1,z:-e},normal:{x:0,y:-1,z:0},command:"L",angle:180},{position:{x:-i,y:-1,z:-e},normal:{x:0,y:-1,z:0},command:"l",angle:180,twinWithPrevious:!0},{position:{x:-1,y:-1,z:e},normal:{x:0,y:-1,z:0},command:"L'",angle:0},{position:{x:-i,y:-1,z:e},normal:{x:0,y:-1,z:0},command:"l'",angle:0,twinWithPrevious:!0},{position:{x:e,y:-1,z:-1},normal:{x:0,y:-1,z:0},command:"B",angle:-90},{position:{x:e,y:-1,z:-i},normal:{x:0,y:-1,z:0},command:"b",angle:-90,twinWithPrevious:!0},{position:{x:e,y:-1,z:1},normal:{x:0,y:-1,z:0},command:"F'",angle:-90},{position:{x:e,y:-1,z:i},normal:{x:0,y:-1,z:0},command:"f'",angle:-90,twinWithPrevious:!0},{position:{x:-e,y:-1,z:-1},normal:{x:0,y:-1,z:0},command:"B'",angle:90},{position:{x:-e,y:-1,z:-i},normal:{x:0,y:-1,z:0},command:"b'",angle:90,twinWithPrevious:!0},{position:{x:-e,y:-1,z:1},normal:{x:0,y:-1,z:0},command:"F",angle:90},{position:{x:-e,y:-1,z:i},normal:{x:0,y:-1,z:0},command:"f",angle:90,twinWithPrevious:!0},{position:{x:-2,y:0,z:1},normal:{x:0,y:0,z:1},command:"y",angle:90,permanent:"up"},{position:{x:0,y:-2,z:1},normal:{x:0,y:0,z:1},command:"x'",angle:180,permanent:"up"},{position:{x:0,y:1,z:-2},normal:{x:0,y:1,z:0},command:"x",angle:0,permanent:"up"},{position:{x:-2,y:1,z:0},normal:{x:0,y:1,z:0},command:"z'",angle:90,permanent:"up"},{position:{x:1,y:0,z:-2},normal:{x:1,y:0,z:0},command:"y'",angle:-90,permanent:"up"},{position:{x:1,y:-2,z:0},normal:{x:1,y:0,z:0},command:"z",angle:180,permanent:"up"},{position:{x:-2,y:0,z:1},normal:{x:0,y:0,z:1},command:"y",angle:90,permanent:"down"},{position:{x:0,y:2,z:1},normal:{x:0,y:0,z:1},command:"x",angle:0,permanent:"down"},{position:{x:0,y:-1,z:-2},normal:{x:0,y:-1,z:0},command:"x'",angle:180,permanent:"down"},{position:{x:-2,y:-1,z:0},normal:{x:0,y:-1,z:0},command:"z",angle:90,permanent:"down"},{position:{x:1,y:0,z:-2},normal:{x:1,y:0,z:0},command:"y'",angle:-90,permanent:"down"},{position:{x:1,y:2,z:0},normal:{x:1,y:0,z:0},command:"z'",angle:0,permanent:"down"},{position:{x:0,y:0,z:1},normal:{x:0,y:0,z:1},command:"F",angle:0,material:this.roundArrowMaterial},{position:{x:0,y:1,z:0},normal:{x:0,y:1,z:0},command:"U",angle:0,material:this.roundArrowMaterial},{position:{x:1,y:0,z:0},normal:{x:1,y:0,z:0},command:"R",angle:0,material:this.roundArrowMaterial},{position:{x:0,y:-1,z:0},normal:{x:0,y:-1,z:0},command:"D",angle:0,material:this.roundArrowMaterial}];for(this.arrowMeshes=[],this.arrows=[],this.arrowNode=new THREE.Object3D,t=0;t<s.length;t++){var n=new o({material:s[t].material||this.straightArrowMaterial,position:s[t].position,normal:s[t].normal,node:this.arrowNode,command:s[t].command,altCommand:s[t].altCommand,two:s[t].two,angle:s[t].angle,size:this.cube3d.size,permanent:s[t].permanent,noshift:s[t].noshift});this.arrows.push(n),this.arrowMeshes.push(n.mesh)}this.scene.add(this.arrowNode)},n.prototype.playCommands=function(t){function e(o){i.cube3d.startCommand(t[o],function(){o<t.length&&e(o+1)})}var i=this;e(0)},n.prototype.addCommands=function(t){this.commandQueue=this.commandQueue.concat(t)},n.prototype.playFormula=function(t){var e=i.parse(t);this.addCommands(e)},n.prototype.startAnimationLoop=function(){this.stopAnimation&&(this.stopAnimation=!1,this.animate()),this.stopAnimationTimeout&&clearTimeout(this.stopAnimationTimeout);this.stopAnimationTimeout=null};var r=!1,a=35.2643896828,h=a/180*Math.PI;n.prototype.animate=function(){var t=this;this.stopAnimation||requestAnimationFrame(function(){t.animate()});var e=0;for(e=0;e<this.arrows.length;e++)this.arrows[e].permanent&&!this.cameraMove&&this.arrows[e].setVisible(!(!this.mouseIn||this.arrows[e].permanent!==this.position),this.frameIndex);do this.cube3d.continueCommand(2e3/60,function(){t.commandQueue.length>0?(t.cube3d.startCommand(t.commandQueue.shift(),!0),r=!0):r=!1});while(this.cube3d.instantMode&&this.commandQueue.length);!this.cameraMove;for(e=0;e<this.arrows.length;e++)this.arrows[e].updateMesh(this.frameIndex);var i="up"===this.position?0:-2*h;if(this.cameraMove&&this.cameraMove.position){this.cameraMove.ended&&(this.cameraMove.k-=.05,this.cameraMove.k<0&&(this.cameraMove.k=0)),this.cube3d.node.setRotationFromQuaternion(new THREE.Quaternion);var o=.01*(this.cameraMove.position.y-this.cameraMove.start.y),s=.01*(this.cameraMove.position.x-this.cameraMove.start.x);this.cameraMove.ended&&(o+=(1-this.cameraMove.k)*(this.cameraMove.target.y-this.cameraMove.position.y)*.01,s+=(1-this.cameraMove.k)*(this.cameraMove.target.x-this.cameraMove.position.x)*.01),"up"===this.position?(o>0&&(o=0),o<2*-h&&(o=2*-h)):(o<0&&(o=0),o>2*h&&(o=2*h)),this.cube3d.node.setRotationFromAxisAngle(new THREE.Vector3(1/Math.sqrt(2),0,-1/Math.sqrt(2)),o+i),this.cube3d.node.rotateY(s),0===this.cameraMove.k&&(this.addCommands(this.cameraMove.commands),this.cameraMove=null)}else this.cube3d.node.setRotationFromAxisAngle(new THREE.Vector3(1/Math.sqrt(2),0,-1/Math.sqrt(2)),i),this.arrowNode.setRotationFromAxisAngle(new THREE.Vector3(1/Math.sqrt(2),0,-1/Math.sqrt(2)),i);this.renderer&&this.renderer.render(this.scene,this.camera),this.frameIndex++};var l=0;return n.prototype.computeMousePosition=function(t){for(var e={},i=this.renderer.domElement,o=i,e={x:t.pageX,y:t.pageY};o;)e.x-=o.offsetLeft,e.y-=o.offsetTop,o=o.parentElement;return e.x=2*e.x/i.width-1,e.y=-2*e.y/i.height+1,e},n.prototype.onMouseMove=function(t){this.startAnimationLoop(),this.mouseIn=!0;var e;if(this.cameraMove&&!this.cameraMove.ended){this.cameraMove.position={x:t.clientX,y:t.clientY};var i=new THREE.Raycaster,o={},s=this.renderer,n=this.camera;s.domElement;for(o=this.computeMousePosition(t),i.setFromCamera(o,n),this.cameraMove.currentRaycaster=i,this.cameraMove.k=1,l++,a=0;a<this.arrows.length;a++)e=this.arrows[a],e.setVisible(!1,this.frameIndex)}else if(!r){var a=0,i=new THREE.Raycaster,o={},s=this.renderer,n=this.camera;s.domElement;o=this.computeMousePosition(t),i.setFromCamera(o,n);var h,c,u=i.intersectObjects(this.cube3d.getMeshes());for(a=0;a<u.length&&!c;a++)h=u[0].object.mytile,c=h.normal;for(a=0;a<this.arrows.length;a++)e=this.arrows[a],this.mouseIn&&(e.permanent===this.position||!e.permanent&&c&&e.normal.x===c.x&&e.normal.y===c.y&&e.normal.z===c.z)?e.setVisible(!0,this.frameIndex):e.setVisible(!1,this.frameIndex);u=i.intersectObjects(this.arrowMeshes);var m=[];for(a=0;a<u.length;a++)u[a].object.visible&&m.push(u[a].object.myarrow);for(a=0;a<this.arrows.length;a++)e=this.arrows[a],m.indexOf(e)>=0?e.setHighlight(!0,this.frameIndex):e.setHighlight(!1,this.frameIndex)}},n.prototype.onMouseUp=function(t){if(t.preventDefault(),this.cameraMove){if(!this.cameraMove.ended&&this.cameraMove.position){this.cameraMove.target={x:this.cameraMove.start.x,y:this.cameraMove.start.y};var e=.01*(this.cameraMove.position.y-this.cameraMove.start.y),i=.01*(this.cameraMove.position.x-this.cameraMove.start.x),o=0,s=i<0?-Math.PI/2:Math.PI/2;this.cameraMove.commands=["0"];var n=i<0?"y":"y'";for(o=s/2;o>-Math.abs(i)&&o<Math.abs(i);o+=s)this.cameraMove.commands.push(n),this.cameraMove.target.x+=s/.01;"up"===this.position?e<-1.33333*h&&(this.cameraMove.target.y-=2*h/.01,this.cameraMove.start.y-=2*h/.01,this.position="down"):e>1.33333*h&&(this.cameraMove.target.y+=2*h/.01,this.cameraMove.start.y+=2*h/.01,this.position="up"),this.cameraMove.commands.push("1")}this.cameraMove.ended=!0,this.cameraMove.position||(this.cameraMove=null)}},n.prototype.onMouseLeave=function(t){this.mouseIn=!1,this.cameraMove&&(this.cameraMove.ended=!0,this.cameraMove.target=this.cameraMove.start);var e,i;for(e=0;e<this.arrows.length;e++)i=this.arrows[e],i.setVisible(!1,this.frameIndex)},n.prototype.onMouseDown=function(t){t.preventDefault();var e=new THREE.Raycaster,o={},s=this.renderer,n=this.camera;s.domElement;o=this.computeMousePosition(t),e.setFromCamera(o,n);var r,a,h=e.intersectObjects(this.arrowMeshes),l=!1;h.length>0?(r=h[0].object.myarrow.command,a=h[0].object.myarrow.altCommand,a=a||r.toLowerCase(),r=t.shiftKey||2===t.which?a:r,3===t.which&&(l=!0),this.addCommands(i.parse(r,l))):(this.cameraMove={start:{x:t.clientX,y:t.clientY},changeMode:1===t.which},this.mainDirection=new THREE.Vector3(1,1,1),this.mainDirection.normalize(),this.cameraMove.originRaycaster=e)},n.prototype.onKeyDown=function(t){var e=t.str.toUpperCase();"X"!==e&&"Y"!==e&&"Z"!==e||(e=e.toLowerCase()),t.shiftKey&&(e+="'"),this.commandQueue.push(e)},n.prototype.getHistory=function(t){var e=this.cube3d.history.join("");return t?e.replace(/'/g,"p"):e},n}),define("scene/FormulaPlayer",["cube/Cube","cube/Cube3D","cube/Interpreter","scene/ArrowMesh","scene/PlayBackButtonFactory"],function(t,e,i,o,s){"use strict";var n=function(e){function i(t,e,i){t.material=b;var o=E.buttonsSize/E.height,s=e*o,n=.5*o*1.2;t.quaternion.copy(E.camera.quaternion),n=w.top-n*(w.top-w.bottom),s=w.left+s*(w.right-w.left),t.position.set(3+s*y.x-n*g.x,3+s*y.y-n*g.y,3+s*y.z-n*g.z),E.scene.add(t),t.geometry.computeBoundingBox(),E.buttons.push({mesh:t,x:E.buttonsSize*e+E.height*t.geometry.boundingBox.min.x/(w.top-w.bottom),y:E.height-1.2*E.buttonsSize,width:E.height*(t.geometry.boundingBox.max.x-t.geometry.boundingBox.min.x)/(w.top-w.bottom),height:E.buttonsSize,action:i})}this.width=e.width||400,this.height=e.height||400,this.buttonsSize=e.buttonsSize||25,this.formula=e.formula,this.commandQueue=[],this.startCube=new t({empty:!0}),e.fillString?this.startCube.fillFromString(e.fillString):this.startCube.fill(),this.scene=new THREE.Scene,this.root=new THREE.Object3D,this.scene.add(this.root),this.cameraMove=null,this.pause=!0,this.ended=!1,this.single=0;var n=.0108;this.camera=new THREE.OrthographicCamera(n*-480/2,480*n/2,480*n/2,n*-480/2,-100,100),this.camera.position.set(4,4,4),this.camera.up=new THREE.Vector3(0,1,0),this.camera.lookAt(new THREE.Vector3(0,0,0)),this.renderer=new THREE.WebGLRenderer({antialias:!0,backgroundColor:"blue"}),this.renderer.setSize(this.width,this.height),this.domElement=this.renderer.domElement;var r=new THREE.DirectionalLight(16777215,1);r.position.set(1,1,.5),this.scene.add(r);var a=new THREE.DirectionalLight(16777215,.5);a.position.set(-1,-1,.5),this.scene.add(a),this.cube3d=null,this.initCube(),this.renderer.setClearColor(new THREE.Color(.8,.8,.8),1),this.arrows=[];var h;if(e.arrows){var l=1.52;for(h=0;h<e.arrows.length;h++){var c=e.arrows[h],u=c.start,m=c.end,d=c.normal,p=new o({start:new THREE.Vector3(1*(u.x||0)+l*d.x,1*(u.y||0)+l*d.y,1*(u.z||0)+l*d.z),end:new THREE.Vector3(1*(m.x||0)+l*d.x,1*(m.y||0)+l*d.y,1*(m.z||0)+l*d.z),normal:new THREE.Vector3(d.x,d.y,d.z),headSize:.3,width:.15}),f=new THREE.Mesh(p,new THREE.MeshBasicMaterial({color:"black",side:THREE.DoubleSide}));this.root.add(f),this.arrows.push(f)}}this.camera.updateMatrix();var y=new THREE.Vector3(1,0,0);y.applyQuaternion(this.camera.quaternion);var g=new THREE.Vector3(0,1,0);g.applyQuaternion(this.camera.quaternion);var w=this.camera,v=this.buttonsSize*(w.top-w.bottom)/this.height,x=new s(v),b=new THREE.MeshBasicMaterial({color:"black",side:THREE.DoubleSide,transparent:!0,opacity:0});this.buttonsMaterial=b,this.buttons=[];var E=this,M=x.createPlayButton();i(M,4.75,"onPlayButton"),this.playButton=M;var z=x.createPauseButton();i(z,4.75,"onPauseButton"),this.pauseButton=z,z.visible=!1;var T=x.createRestartButton();i(T,1,"onRestartButton"),this.restartButton=T;var R=x.createNextButton();i(R,8,"onNextButton"),this.nextButton=R;var H=this.domElement;H.addEventListener("mousemove",this.onMouseMove.bind(this)),H.addEventListener("mousedown",this.onMouseDown.bind(this)),H.addEventListener("mouseup",this.onMouseUp.bind(this)),H.addEventListener("mouseleave",this.onMouseLeave.bind(this)),this.playFormula(this.formula)};n.prototype.initCube=function(){this.cube3d&&this.root.remove(this.cube3d.node),this.cube3d=new e({size:1,cube:this.startCube}),this.root.add(this.cube3d.node)},n.prototype.computeMousePosition=function(t){for(var e={},i=this.domElement,e={x:t.pageX,y:t.pageY};i;)e.x-=i.offsetLeft,e.y-=i.offsetTop,i=i.parentElement;return e},n.prototype.getButtonFromMousePosition=function(t){var e,i;for(e=0;e<this.buttons.length;e++)if(i=this.buttons[e],i.mesh.visible&&t.x>=i.x&&t.y>=i.y&&t.x<i.x+i.width&&t.y<i.y+i.height)return i;return null},n.prototype.setHighlight=function(t,e){function i(){var i;e?t.counter++:t.counter--,t.counter>2&&(t.counter=2,clearInterval(t.token)),t.counter<0&&(t.counter=0,clearInterval(t.token)),i=1+.1*t.counter,t.mesh.scale.set(i,i,i)}if(t&&t.highlight!==e){t.token&&(clearInterval(t.token),t.token=null),t.counter||0===t.counter||(t.counter=0);t.counter;t.token=setInterval(i,50),i()}},n.prototype.showButtons=function(){if(!this.oldButtonsVisibility){this.oldButtonsVisibility=!0;var t=this.buttonsMaterial;clearInterval(this.mouseInsideToken);var e=this;this.mouseInsideToken=setInterval(function(){t.opacity+=.3333333333333333,t.opacity>1&&(t.opacity=1,clearInterval(e.mouseInsideToken))},50)}},n.prototype.hideButtons=function(){if(this.oldButtonsVisibility){this.oldButtonsVisibility=!1;var t=this.buttonsMaterial,e=this;clearInterval(this.mouseInsideToken),this.mouseInsideToken=setInterval(function(){t.opacity-=.3333333333333333,t.opacity<0&&(t.opacity=0,clearInterval(e.mouseInsideToken))},50)}},n.prototype.onMouseMove=function(t){if(this.mouseInside=!0,this.cameraMove&&!this.cameraMove.ended)this.cameraMove.position={x:t.clientX,y:t.clientY};else{var e=this.computeMousePosition(t),i=this.getButtonFromMousePosition(e);this.highlightButton!==i&&(this.setHighlight(this.highlightButton,!1),this.setHighlight(i,!0),this.highlightButton=i)}},n.prototype.onMouseDown=function(t){var e=this.computeMousePosition(t),i=this.getButtonFromMousePosition(e);this.currentButton=i,i||this.cameraMove||(this.cameraMove={start:{x:t.clientX,y:t.clientY},k:1,ended:!1})},n.prototype.onMouseUp=function(t){if(this.cameraMove)this.cameraMove.position?this.cameraMove.ended=!0:this.cameraMove=null;else{var e=this.computeMousePosition(t),i=this.getButtonFromMousePosition(e);i&&i===this.currentButton&&this[i.action](),this.currentButton=null}},n.prototype.onMouseLeave=function(t){this.mouseInside=!1,this.curentButton=null,this.highlightButton&&(this.setHighlight(this.highlightButton,!1),this.highlightButton=null),this.cameraMove&&(this.cameraMove.ended=!0)},n.prototype.onPlayButton=function(){this.pause=!1,this.playButton.visible=!1,this.pauseButton.visible=!0,this.nextButton.visible=!1,this.restartButton.visible=!1,this.pause=!1},n.prototype.onPauseButton=function(){this.pause=!0,this.playButton.visible=!this.ended,this.pauseButton.visible=!1,this.nextButton.visible=!this.ended,this.restartButton.visible=!0},n.prototype.onRestartButton=function(){this.initCube(),this.setArrowsVisibility(!0),this.commandQueue=[],this.playFormula(this.formula),this.onPauseButton()},n.prototype.onNextButton=function(){this.pause=!1,this.single++},n.prototype.setArrowsVisibility=function(t){var e;for(e=0;e<this.arrows.length;e++)this.arrows[e].visible=t},n.prototype.addCommands=function(t){this.commandQueue=this.commandQueue.concat(t)},n.prototype.playFormula=function(t){this.ended=!1;var e=i.parse(t);this.addCommands(e)},n.prototype.startAnimationLoop=function(){this.animate()};var r=!1;return n.prototype.animate=function(){requestAnimationFrame(this.animate.bind(this));var t=this;do this.cube3d.continueCommand(2e3/60,function(){0===t.commandQueue.length?(t.onPauseButton(),r=!1,t.ended=!0):t.pause?r=!1:(t.setArrowsVisibility(!1),t.single&&(t.single--,t.pause=!t.single),t.cube3d.startCommand(t.commandQueue.shift(),!0),r=!0)});while(this.cube3d.instantMode&&this.commandQueue.length);if(this.cameraMove&&this.cameraMove.position){this.cameraMove.ended&&(this.cameraMove.k-=.05,this.cameraMove.k<0&&(this.cameraMove.k=0));var e=.02*(this.cameraMove.position.y-this.cameraMove.start.y),i=.02*(this.cameraMove.position.x-this.cameraMove.start.x);e*=this.cameraMove.k,i*=this.cameraMove.k,this.root.setRotationFromAxisAngle(new THREE.Vector3(1/Math.sqrt(2),0,-1/Math.sqrt(2)),e),this.root.rotateY(i),0===this.cameraMove.k&&(this.cameraMove=null)}this.mouseInside&&!this.cameraMove?this.showButtons():this.hideButtons(),this.renderer.render(this.scene,this.camera)},n});
